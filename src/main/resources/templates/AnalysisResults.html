<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results | Feedback Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .stat-card {
            border-left: 4px solid;
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card.positive { border-left-color: #28a745; }
        .stat-card.negative { border-left-color: #dc3545; }
        .stat-card.neutral { border-left-color: #6c757d; }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .insights-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 2rem;
        }
        .sentiment-badge {
            font-size: 0.85rem;
            padding: 0.35rem 0.7rem;
        }
    </style>
</head>
<body class="bg-light">

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" th:href="@{/}">ü§ñ AI Feedback Analyzer</a>
    </div>
</nav>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold text-primary mb-0">üìä Analysis Results</h1>
            <p class="text-muted mb-0">AI-powered insights from your feedbacks</p>
        </div>
        <a th:href="@{/AddFeedback}" class="btn btn-secondary">‚¨ÖÔ∏è Back to Feedbacks</a>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card stat-card shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Total Feedbacks</h6>
                    <h2 class="fw-bold text-primary" th:text="${totalFeedbacks}">0</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card positive shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Positive</h6>
                    <h2 class="fw-bold text-success">
                        <span th:text="${positivePercentage}">0</span>%
                    </h2>
                    <small class="text-muted">
                        <span th:text="${positiveCount}">0</span> feedbacks
                    </small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card negative shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Negative</h6>
                    <h2 class="fw-bold text-danger">
                        <span th:text="${negativePercentage}">0</span>%
                    </h2>
                    <small class="text-muted">
                        <span th:text="${negativeCount}">0</span> feedbacks
                    </small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card neutral shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Neutral</h6>
                    <h2 class="fw-bold text-secondary">
                        <span th:text="${neutralPercentage}">0</span>%
                    </h2>
                    <small class="text-muted">
                        <span th:text="${neutralCount}">0</span> feedbacks
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title fw-bold mb-3">üìä Sentiment Distribution</h5>
                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title fw-bold mb-3">üìà Sentiment Breakdown</h5>
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overall Insights -->
    <div class="card shadow-sm mb-4">
        <div class="card-body insights-box">
            <h5 class="fw-bold mb-3">üí° AI-Generated Insights</h5>
            <p class="mb-0" th:text="${overallInsights}">
                Overall insights from AI analysis will appear here...
            </p>
        </div>
    </div>

    <!-- Individual Feedbacks with Analysis -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="fw-bold mb-3">üìù Individual Feedback Analysis</h5>
            <div class="row">
                <div class="col-md-12 mb-3" th:each="feedback : ${feedbacks}">
                    <div class="card border-start border-3"
                         th:classappend="${feedback.sentiment == 'POSITIVE'} ? 'border-success' :
                                         (${feedback.sentiment == 'NEGATIVE'} ? 'border-danger' : 'border-secondary')">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="text-muted mb-0">Feedback #<span th:text="${feedback.id}">1</span></h6>
                                <span th:if="${feedback.sentiment == 'POSITIVE'}"
                                      class="badge sentiment-badge bg-success">‚úì POSITIVE</span>
                                <span th:if="${feedback.sentiment == 'NEGATIVE'}"
                                      class="badge sentiment-badge bg-danger">‚úó NEGATIVE</span>
                                <span th:if="${feedback.sentiment == 'NEUTRAL' or feedback.sentiment == null}"
                                      class="badge sentiment-badge bg-secondary">‚Äï NEUTRAL</span>
                            </div>
                            <p class="mb-2" th:text="${feedback.feedback}">Feedback text here</p>
                            <div class="alert alert-light mb-0 mt-2" th:if="${feedback.analysis != null}">
                                <small><strong>AI Summary:</strong> <span th:text="${feedback.analysis}">Analysis</span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="text-center text-muted py-3 mt-5">
    &copy; 2025 AI Feedback Analyzer | Powered by Google Gemini
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    // Get data from Thymeleaf
    const positiveCount = /*[[${positiveCount}]]*/ 0;
    const negativeCount = /*[[${negativeCount}]]*/ 0;
    const neutralCount = /*[[${neutralCount}]]*/ 0;

    // Pie Chart
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: ['Positive', 'Negative', 'Neutral'],
            datasets: [{
                data: [positiveCount, negativeCount, neutralCount],
                backgroundColor: [
                    'rgba(40, 167, 69, 0.8)',
                    'rgba(220, 53, 69, 0.8)',
                    'rgba(108, 117, 125, 0.8)'
                ],
                borderColor: [
                    'rgba(40, 167, 69, 1)',
                    'rgba(220, 53, 69, 1)',
                    'rgba(108, 117, 125, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // Bar Chart
    const barCtx = document.getElementById('barChart').getContext('2d');
    new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: ['Positive', 'Negative', 'Neutral'],
            datasets: [{
                label: 'Number of Feedbacks',
                data: [positiveCount, negativeCount, neutralCount],
                backgroundColor: [
                    'rgba(40, 167, 69, 0.7)',
                    'rgba(220, 53, 69, 0.7)',
                    'rgba(108, 117, 125, 0.7)'
                ],
                borderColor: [
                    'rgba(40, 167, 69, 1)',
                    'rgba(220, 53, 69, 1)',
                    'rgba(108, 117, 125, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
</script>
</body>
</html>